{
  "title": "Grail Hunter - Phase 4.2: Compliance-First Hybrid",
  "description": "Monitor 8 platforms with ingestion-first options for GOAT/StockX, safer defaults, live market scoring, persistent dedupe, and real-time alerts. High-risk/beta platforms require acknowledgment.",
  "type": "object",
  "schemaVersion": 1,
  "properties": {
    "keywords": {
      "title": "Search Keywords",
      "type": "array",
      "description": "Sneaker models or keywords to search for (e.g., 'Air Jordan 1', 'Yeezy 350', 'Nike Dunk Low Panda'). You can specify multiple keywords.",
      "editor": "stringList",
      "prefill": ["Air Jordan 1", "Nike Dunk Low"],
      "minItems": 1,
      "maxItems": 20
    },
    "size": {
      "title": "Desired Size (US Men's)",
      "type": "string",
      "description": "Filter by US Men's shoe size (e.g., '10', '10.5', '11'). Leave empty to see all sizes.",
      "editor": "textfield",
      "pattern": "^([1-9]|1[0-5])(\\.5)?$",
      "example": "10.5"
    },
    "priceRange": {
      "title": "Price Range (USD)",
      "type": "object",
      "description": "Filter listings by price range in US dollars (max must be greater than or equal to min)",
      "editor": "json",
      "properties": {
        "min": {
          "type": "number",
          "title": "Minimum Price",
          "description": "Minimum price in USD (leave empty for no minimum)",
          "minimum": 0
        },
        "max": {
          "type": "number",
          "title": "Maximum Price",
          "description": "Maximum price in USD (leave empty for no maximum)",
          "minimum": 0
        }
      },
      "prefill": {
        "min": 50,
        "max": 500
      }
    },
    "condition": {
      "title": "Minimum Condition",
      "type": "string",
      "description": "Only show listings in this condition or better",
      "editor": "select",
      "enum": ["new_in_box", "used_like_new", "used_good", "used_fair", "used_poor", "unspecified"],
      "enumTitles": [
        "New in Box (DS/BNIB)",
        "Used - Like New (VNDS)",
        "Used - Good (NDS)",
        "Used - Fair",
        "Used - Poor",
        "Any Condition"
      ],
      "default": "used_good"
    },
    "platform": {
      "title": "Legacy Single Platform",
      "type": "string",
      "description": "Backward-compatible single-platform selector (defaults to Grailed). Use the Platforms list below for Phase 2 multi-platform runs.",
      "editor": "select",
      "enum": ["grailed"],
      "enumTitles": ["Grailed"],
      "default": "grailed"
    },
    "platforms": {
      "title": "Platforms",
      "type": "array",
      "description": "Select one or more platforms to search. Depop/Poshmark are safer. Mercari/OfferUp are BETA (higher failure risk). GOAT/StockX are HIGH RISK and require explicit toggles + acknowledgment. Leave empty to fall back to the single 'Legacy Single Platform' field.",
      "editor": "select",
      "items": {
        "type": "string",
        "enum": ["grailed", "ebay", "stockx", "depop", "poshmark", "mercari", "offerup", "goat"],
        "enumTitles": [
          "Grailed",
          "eBay",
          "StockX (‚ö†Ô∏è  HIGH RISK)",
          "Depop",
          "Poshmark",
          "Mercari (üß™ BETA)",
          "OfferUp (üß™ BETA)",
          "GOAT (‚ö†Ô∏è  HIGH RISK)"
        ]
      },
      "uniqueItems": true
    },
    "ingestionDatasets": {
      "title": "Dataset Ingestion (Safer Mode)",
      "type": "array",
      "description": "Bring-your-own data for GOAT/StockX (recommended). Each entry should include datasetId and platform (goat or stockx).",
      "editor": "json",
      "items": {
        "type": "object",
        "properties": {
          "datasetId": {
            "type": "string",
            "title": "Dataset ID",
            "description": "Apify dataset ID containing listing-like records"
          },
          "platform": {
            "type": "string",
            "title": "Platform",
            "enum": ["goat", "stockx"]
          },
          "platformLabel": {
            "type": "string",
            "title": "Label (optional)",
            "description": "Custom label for observability"
          }
        },
        "required": ["datasetId", "platform"]
      }
    },
    "maxResults": {
      "title": "Max Results to Scrape",
      "type": "number",
      "description": "Maximum number of listings to scrape per platform (1-500)",
      "default": 50,
      "minimum": 1,
      "maximum": 500
    },
    "marketDataSources": {
      "title": "Live Market Data Datasets",
      "type": "array",
      "description": "Optional: dataset IDs providing live market baselines (e.g., StockX/GOAT asks/bids). Improves deal scoring accuracy.",
      "editor": "json",
      "items": {
        "type": "object",
        "properties": {
          "datasetId": {
            "type": "string",
            "title": "Dataset ID",
            "description": "Apify dataset ID with market price records"
          },
          "label": {
            "type": "string",
            "title": "Label",
            "description": "Friendly label for observability"
          }
        },
        "required": ["datasetId"]
      }
    },
    "notificationConfig": {
      "title": "Notification Settings",
      "type": "object",
      "description": "Configure how you receive alerts for new listings. Results are ALWAYS saved to Apify dataset.",
      "editor": "json",
      "properties": {
        "webhookUrl": {
          "type": "string",
          "title": "Webhook URL",
          "description": "POST notifications to this URL when new listings are found (e.g., for Zapier, Make.com, or custom endpoint)",
          "editor": "textfield"
        },
        "webhookSecret": {
          "type": "string",
          "title": "Webhook Secret (Optional)",
          "description": "Secret key for HMAC-SHA256 signature verification (sent in X-Grail-Hunter-Signature header)",
          "editor": "textfield"
        },
        "emailWebhookUrl": {
          "type": "string",
          "title": "Email Webhook URL",
          "description": "Endpoint to fan out emails (e.g., SendGrid/Twilio/Zapier webhook). Payload includes subject, recipients, listings.",
          "editor": "textfield"
        },
        "emailRecipients": {
          "type": "array",
          "title": "Email Recipients",
          "description": "List of recipient emails when using emailWebhookUrl",
          "items": { "type": "string" }
        },
        "slackWebhookUrl": {
          "type": "string",
          "title": "Slack Webhook URL",
          "description": "Slack incoming webhook for alerts",
          "editor": "textfield"
        },
        "discordWebhookUrl": {
          "type": "string",
          "title": "Discord Webhook URL",
          "description": "Discord webhook for alerts",
          "editor": "textfield"
        },
        "smsWebhookUrl": {
          "type": "string",
          "title": "SMS Webhook URL",
          "description": "Endpoint to trigger SMS (e.g., Twilio/SNS webhook)",
          "editor": "textfield"
        },
        "smsRecipients": {
          "type": "array",
          "title": "SMS Recipients",
          "description": "Phone numbers to alert via smsWebhookUrl",
          "items": { "type": "string" }
        }
      }
    },
    "stateStoreId": {
      "title": "State Store ID",
      "type": "string",
      "description": "KV store name for deduplication and price history persistence across runs (default: grail-hunter-state)",
      "default": "grail-hunter-state",
      "pattern": "^.{3,}$"
    },
    "proxyConfig": {
      "title": "Proxy Configuration",
      "type": "object",
      "description": "Proxy settings (recommended: use Apify residential proxies for reliability)",
      "editor": "proxy",
      "default": {
        "useApifyProxy": true,
        "apifyProxyGroups": ["RESIDENTIAL"]
      }
    },
    "excludeAuctions": {
      "title": "Exclude Auction Listings",
      "type": "boolean",
      "description": "If enabled, filters eBay results to Buy It Now where possible and marks auctions distinctly.",
      "default": false
    },
    "authenticatedOnly": {
      "title": "Authenticated Listings Only",
      "type": "boolean",
      "description": "Only show listings from authenticated platforms (StockX, GOAT) or with authenticity guarantees (eBay). Filters out peer-to-peer marketplaces without authentication.",
      "default": false
    },
    "requireOGAll": {
      "title": "Require Original Box & Accessories",
      "type": "boolean",
      "description": "Only show listings that include the original box and all accessories (OG All). Filters out listings with replacement boxes or no box.",
      "default": false
    },
    "minSellerRating": {
      "title": "Minimum Seller Rating",
      "type": "number",
      "description": "Minimum seller rating on a 0-5 scale (e.g., 4.5). Listings from sellers below this rating will be filtered out. Set to 0 to disable.",
      "default": 0,
      "minimum": 0,
      "maximum": 5
    },
    "minSellerReviewCount": {
      "title": "Minimum Seller Review Count",
      "type": "number",
      "description": "Minimum number of seller reviews/transactions. Filters out sellers with fewer reviews. Set to 0 to disable.",
      "default": 0,
      "minimum": 0,
      "maximum": 100000
    },
    "dealScoreThreshold": {
      "title": "Deal Score Threshold (%)",
      "type": "number",
      "description": "Minimum savings percentage to consider a listing as a deal (default: 10%). The Excellent Deal Threshold must always be greater than or equal to this value‚Äîruns fail validation if misconfigured.",
      "default": 10,
      "minimum": 0,
      "maximum": 100
    },
    "excellentDealThreshold": {
      "title": "Excellent Deal Threshold (%)",
      "type": "number",
      "description": "Savings percentage required for 'excellent' deal quality (default: 30%). Must be greater than or equal to the Deal Score Threshold or the actor input will be rejected.",
      "default": 30,
      "minimum": 0,
      "maximum": 100
    },
    "priceDropThreshold": {
      "title": "Price Drop Alert Threshold (%)",
      "type": "number",
      "description": "Minimum price drop percentage to trigger alerts (default: 10%)",
      "default": 10,
      "minimum": 0,
      "maximum": 100
    },
    "marketValueOverrides": {
      "title": "Market Value Overrides",
      "type": "object",
      "description": "Override market values for specific sneakers (JSON object with sneaker name or SKU as key, market value as value)",
      "editor": "json",
      "prefill": {}
    },
    "enableStockX": {
      "title": "Enable StockX Scraping (‚ö†Ô∏è  HIGH RISK)",
      "type": "boolean",
      "description": "WARNING: StockX actively enforces ToS. Scraping may result in IP blocks or legal action. Dataset ingestion (Pattern C) recommended instead. Use at your own risk.",
      "default": false
    },
    "allowStockXApiFallback": {
      "title": "Allow StockX API Fallback (‚ö†Ô∏è  VERY HIGH RISK)",
      "type": "boolean",
      "description": "Disabled by default. When true, permits direct StockX API fallback if orchestrated actor fails. Requires acknowledgePlatformTerms=true and residential proxies.",
      "default": false
    },
    "enableGOAT": {
      "title": "Enable GOAT Scraping (‚ö†Ô∏è  HIGH RISK)",
      "type": "boolean",
      "description": "WARNING: GOAT actively enforces ToS. Scraping may result in IP blocks or legal action. Dataset ingestion (Pattern C) strongly recommended instead. Use at your own risk. Default: false (disabled).",
      "default": false
    },
    "betaPlatformsEnabled": {
      "title": "Enable Beta Platforms (üß™ EXPERIMENTAL)",
      "type": "boolean",
      "description": "Global toggle to enable beta platforms (Mercari, OfferUp). Beta platforms have higher risk of blocking, anti-bot detection, and may fail more frequently. You must also enable individual beta platforms below. Default: false (disabled).",
      "default": false
    },
    "enableMercari": {
      "title": "Enable Mercari (üß™ BETA)",
      "type": "boolean",
      "description": "Enable Mercari scraping. Requires betaPlatformsEnabled=true. WARNING: Mercari has aggressive anti-bot measures and the underlying actor may be unreliable. Scraping may fail frequently. Use at your own risk. Default: false.",
      "default": false
    },
    "enableOfferUp": {
      "title": "Enable OfferUp (üß™ BETA)",
      "type": "boolean",
      "description": "Enable OfferUp scraping. Requires betaPlatformsEnabled=true and a US ZIP code for location-based search. WARNING: OfferUp uses Cloudflare protection and browser automation, which may be slow and fail frequently. Use at your own risk. Default: false.",
      "default": false
    },
    "zipCode": {
      "title": "ZIP Code (for OfferUp)",
      "type": "string",
      "description": "US ZIP code for location-based search on OfferUp. Required when OfferUp is enabled. Format: 5-digit ZIP code (e.g., '10001' for NYC, '90210' for Beverly Hills). Defaults to 10001 (NYC) if not provided.",
      "editor": "textfield",
      "pattern": "^[0-9]{5}$",
      "example": "10001"
    },
    "acknowledgePlatformTerms": {
      "title": "I have rights to access these platforms (required for high-risk/beta)",
      "type": "boolean",
      "description": "Must be true when enabling StockX, GOAT, Mercari, OfferUp, or other beta/high-risk platforms.",
      "default": false
    }
  },
  "required": ["keywords"]
}
